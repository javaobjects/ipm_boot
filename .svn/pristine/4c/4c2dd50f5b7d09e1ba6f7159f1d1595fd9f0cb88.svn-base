<!--[if IE]>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<![endif]-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
        <script type="text/javascript" src="../res/resource/js/plugins/jquery-1.7.2.js"></script>
		<script type="text/javascript" src="../res/resource/js/ext-3.0.0/adapter/ext/ext-base.js"></script>
		<script type="text/javascript" src="../res/resource/js/ext-3.0.0/ext-all.js"></script>
		<script type="text/javascript" src="../res/resource/js/ext-3.0.0/ux/PagingMemoryProxy.js"></script>
        <link rel="stylesheet" type="text/css" href="../res/resource/js/ext-3.0.0/ux/css/ux-all.css" />
		<link rel="stylesheet" type="text/css" href="../res/resource/js/ext-3.0.0/resources/css/ext-all.css"/>

       
 <script type="text/javascript">
 var  treeNode=null;
 window.onload = function() { 
		function jsontTree(data) {
			var jsonArr = [];
			var jsonNode = null;
			var jsonNodeTwo = null;
			var jsonNodeShu=null;
			for(var key in data) {
				jsonNode = {};
				jsonNode.id = key;
				jsonNode.text = key;
				jsonNode.children = [];
				if(typeof(data[key]) === 'object') 
					for(var nodeKey in data[key]) {
						jsonNodeTwo = {};
						jsonNodeTwo.id = nodeKey;
						jsonNodeTwo.text = nodeKey+": "+data[key][nodeKey];
						jsonNodeTwo.leaf=true;
						jsonNodeTwo.children = [];
						jsonNode.children.push(jsonNodeTwo);
					}
				else {
					jsonNodeTwo = {};
					jsonNodeTwo.text = data[key];
					jsonNode.children.push(jsonNodeTwo);
				}
				jsonArr.push(jsonNode);
			}
			return jsonArr;
		}
	 $.ajax({
			url:'/cgi-bin/iDigger.cgi?url=/filter_expression',
			method: "POST",
			success:function(data) {
			   TreeGrid = new Ext.tree.TreePanel({
				    id: "root",
	   		   		autoShow: true, 
 	   		        rootVisible: false,
					style:'background-color: #eee;',
 	   		        renderTo: Ext.getBody(),
 	   		        autoScroll: true,
 	   		        width: 298,
 	   		        height:500,
 	   		        root: new Ext.tree.AsyncTreeNode({
 	   		        	id:'roots',
		  			    expanded: true,
		  			  	children: jsontTree(Ext.decode(data))
	  		       }),
	  		     listeners:{
	  		    	'click':function(node){
					    var  nodes=node.id;
						var  tNode=nodes.replace(/\s/ig,'');
						var  tIndex=tNode.indexOf('-');
						if(tIndex!='-1'){
					       treeNode=nodes.substr(0, tIndex).toLowerCase( );
						}else{
						   treeNode=nodes;
						}
	  		   }   }
 	         });
			   TreeGrid.render();
		}
	});
};  

</script> 
</head>
<body >
</body>
</html>
